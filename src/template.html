<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>{hljs_css}</style>
    <style>{katex_css}</style>
    <style>{css}</style>
</head>
<body>
    <div class="container">
        <div class="content-wrapper">
            <div class="search-bar hidden" id="search-bar">
                <input type="text" id="search-input" placeholder="Search..." />
                <span id="search-count"></span>
                <button onclick="searchPrev()">↑</button>
                <button onclick="searchNext()">↓</button>
                <button onclick="closeSearch()">✕</button>
            </div>
            <main class="content github" id="content">
                <!-- Markdown mode views -->
                <div id="markdown-views" style="display:{md_display}">
                    <div id="github-view" class="view-content">{github_view}</div>
                    <div id="terminal-view" class="view-content" style="display:none;">{terminal_view}</div>
                </div>
                <!-- Notebook mode view -->
                <div id="notebook-view" class="view-content" style="display:{nb_display}">{notebook_view}</div>
            </main>
        </div>
        <nav class="toc hidden" id="toc">
            {toc}
        </nav>
    </div>
    <div class="hotkey-bar" id="hotkey-bar-md" style="display:{md_display}">
        <span><kbd>Tab</kbd> Raw/Formatted</span>
        <span><kbd>T</kbd> ToC</span>
        <span><kbd>D</kbd> ☾/☀</span>
        <span><kbd>⌘C</kbd> Copy Raw Markdown</span>
        <span><kbd>⇧⌘C</kbd> Copy Formatted</span>
    </div>
    <div class="hotkey-bar" id="hotkey-bar-nb" style="display:{nb_display}">
        <span><kbd>C</kbd> Collapse/Expand All Code</span>
        <span><kbd>T</kbd> ToC</span>
        <span><kbd>D</kbd> ☾/☀</span>
    </div>
    <script>{hljs_js}</script>
    <script>{katex_js}</script>
    <script>{katex_auto}</script>
    <script>const markdownLines = [{markdown_lines}];</script>
    <script>const initialSettings = {settings};</script>
    <script>{js}</script>
    <script>
        // Render math in github-view (for markdown files)
        const githubView = document.getElementById('github-view');
        if (githubView) {
            renderMathInElement(githubView, {
                delimiters: [
                    {left: '$$', right: '$$', display: true},
                    {left: '$', right: '$', display: false}
                ],
                throwOnError: false
            });
        }
        // Render math in notebook markdown cells only (not code cells or outputs)
        document.querySelectorAll('#notebook-view .nb-markdown-cell').forEach(cell => {
            renderMathInElement(cell, {
                delimiters: [
                    {left: '$$', right: '$$', display: true},
                    {left: '$', right: '$', display: false}
                ],
                throwOnError: false
            });
        });
    </script>
</body>
</html>
